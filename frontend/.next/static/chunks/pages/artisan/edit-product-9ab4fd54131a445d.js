(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[558],{7103:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/artisan/edit-product",function(){return t(8292)}])},8292:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return c}});var r=t(5893),n=t(7294),s=t(8987),i=t(8506),o=t(1163);function c(){let{isAuthenticated:e,isArtisan:a,user:t}=(0,i.a)(),c=(0,o.useRouter)(),{id:d}=c.query,[l,u]=(0,n.useState)([]),[p,g]=(0,n.useState)({name:"",description:"",price:"",stock:"",category_id:"",images:[],status:"active"}),[m,x]=(0,n.useState)(!1),[f,h]=(0,n.useState)(""),[y,b]=(0,n.useState)(!1);(0,n.useEffect)(()=>{v(),d&&j()},[d]);let v=async()=>{try{let e=await s.Z.get("/api/products/categories");u(e.data)}catch(e){u([])}},j=async()=>{try{x(!0);let e=await s.Z.get("/api/products/".concat(d));if(e.data.artisan_id!==t.id&&!t.isAdmin){h("No tienes permisos para editar este producto."),b(!1);return}g({name:e.data.name,description:e.data.description,price:e.data.price,stock:e.data.stock,category_id:e.data.category_id,images:[],status:e.data.status||"active"}),b(!0)}catch(e){h("No se pudo cargar el producto."),b(!1)}finally{x(!1)}};if(!e||!a)return(0,r.jsx)("div",{className:"text-center py-12",children:"Acceso denegado. Solo artesanos pueden ver esta p\xe1gina."});let N=e=>{g({...p,[e.target.name]:e.target.value})},w=e=>{g({...p,images:Array.from(e.target.files)})},_=async e=>{e.preventDefault(),x(!0),h("");try{let e=new FormData;e.append("name",p.name),e.append("description",p.description),e.append("price",p.price),e.append("stock",p.stock),e.append("category_id",p.category_id),e.append("status",p.status),p.images.forEach(a=>e.append("images",a)),await s.Z.put("/api/products/".concat(d),e,{headers:{"Content-Type":"multipart/form-data"}}),h("Producto actualizado exitosamente"),setTimeout(()=>c.push("/artisan/products"),1500)}catch(e){var a,t;h((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Error al actualizar producto")}finally{x(!1)}};return d?(0,r.jsxs)("div",{className:"max-w-xl mx-auto px-4 py-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6 text-orange-600",children:"Editar Producto"}),y?(0,r.jsxs)("form",{onSubmit:_,className:"bg-white rounded-lg shadow p-6 space-y-4",encType:"multipart/form-data",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-1",children:"Nombre"}),(0,r.jsx)("input",{type:"text",name:"name",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",value:p.name,onChange:N,required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,r.jsx)("textarea",{name:"description",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",value:p.description,onChange:N,required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-1",children:"Precio"}),(0,r.jsx)("input",{type:"number",name:"price",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",value:p.price,onChange:N,required:!0,min:0,step:.01})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-1",children:"Stock"}),(0,r.jsx)("input",{type:"number",name:"stock",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",value:p.stock,onChange:N,required:!0,min:0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-1",children:"Categor\xeda"}),(0,r.jsxs)("select",{name:"category_id",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",value:p.category_id,onChange:N,required:!0,children:[(0,r.jsx)("option",{value:"",children:"Selecciona una categor\xeda"}),l.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-1",children:"Im\xe1genes (nuevas)"}),(0,r.jsx)("input",{type:"file",name:"images",multiple:!0,accept:"image/*",onChange:w,className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-1",children:"Estado"}),(0,r.jsxs)("select",{name:"status",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",value:p.status,onChange:N,required:!0,children:[(0,r.jsx)("option",{value:"active",children:"Activo"}),(0,r.jsx)("option",{value:"inactive",children:"Inactivo"}),(0,r.jsx)("option",{value:"pending",children:"Pendiente"})]})]}),f&&(0,r.jsx)("div",{className:"text-green-600 text-sm",children:f}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition-colors font-semibold",disabled:m,children:m?"Actualizando...":"Actualizar Producto"})]}):(0,r.jsx)("div",{className:"text-center py-12 text-red-600",children:f||"Cargando..."})]}):(0,r.jsx)("div",{className:"text-center py-12",children:"Cargando producto..."})}},1163:function(e,a,t){e.exports=t(6885)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=7103)}),_N_E=e.O()}]);